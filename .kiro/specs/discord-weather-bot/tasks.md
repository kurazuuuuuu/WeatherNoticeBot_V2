# Implementation Plan

- [x] 1. プロジェクト基盤とコア設定の構築
  - プロジェクト構造の作成（ディレクトリ、設定ファイル）
  - 依存関係の定義（requirements.txt）
  - 環境変数設定とコンフィグ管理の実装
  - _Requirements: 1.1, 8.1_

- [x] 2. データベースモデルとマイグレーションの実装
  - SQLAlchemyを使用したUserモデルの作成
  - データベース接続とセッション管理の実装
  - マイグレーション機能の実装
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 3. 気象庁APIサービスの実装
- [x] 3.1 基本的なAPIクライアントの作成
  - aiohttpを使用したHTTPクライアントの実装
  - 気象庁APIのベースURLとエンドポイント定義
  - エラーハンドリングとリトライ機能の実装
  - _Requirements: 1.1, 1.4_

- [x] 3.2 地域情報取得機能の実装
  - area.jsonから地域情報を取得する機能
  - 地域名検索機能（漢字、かな、英語対応）
  - 地域コードの検証機能
  - _Requirements: 3.1, 3.4_

- [x] 3.3 天気情報取得機能の実装
  - 現在の天気情報取得API
  - 天気予報取得API（最大7日間）
  - 気象警報・注意報取得API
  - _Requirements: 1.1, 1.2, 1.3, 4.1, 4.2_

- [x] 4. ユーザー管理サービスの実装
- [x] 4.1 ユーザー位置情報管理
  - ユーザーの地域設定保存機能
  - ユーザー情報の取得・更新機能
  - データベースCRUD操作の実装
  - _Requirements: 3.1, 3.2, 3.3, 3.5_

- [x] 4.2 通知スケジュール管理
  - 1時間単位での通知時間設定機能
  - 通知の有効化・無効化機能
  - ユーザー設定の表示機能
  - _Requirements: 5.1, 5.3_

- [x] 5. Google Gemini AI統合の実装
- [x] 5.1 AIメッセージ生成サービス
  - Google Gemini APIクライアントの実装
  - 天気情報に基づくポジティブメッセージ生成
  - APIエラー時のフォールバック機能
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 6. Discordボットコアの実装
- [ ] 6.1 ボット基盤の構築
  - discord.pyを使用したボットクライアントの作成
  - コマンドハンドラーの基本構造実装
  - ボット起動とシャットダウン処理
  - _Requirements: 1.1, 8.1, 8.3_

- [ ] 6.2 天気情報コマンドの実装
  - `/weather`コマンド（現在の天気）
  - `/forecast`コマンド（天気予報）
  - `/weather-alerts`コマンド（気象警報）
  - _Requirements: 1.1, 1.2, 1.3, 2.1, 2.2, 4.1, 4.2_

- [ ] 6.3 ユーザー設定コマンドの実装
  - `/set-location`コマンド（位置設定）
  - `/schedule-weather`コマンド（通知設定）
  - `/unschedule-weather`コマンド（通知停止）
  - `/my-settings`コマンド（設定表示）
  - _Requirements: 3.1, 3.2, 3.4, 5.1, 5.3_

- [ ] 7. 定時通知システムの実装
- [ ] 7.1 スケジューラーサービスの構築
  - APSchedulerを使用したジョブスケジューラー
  - 1時間単位での通知スケジュール管理
  - ユーザーごとの個別スケジュール処理
  - _Requirements: 5.1, 5.2_

- [ ] 7.2 DM通知機能の実装
  - 定時天気情報のDM送信機能
  - AIメッセージ付き天気情報の配信
  - 送信エラー時のリトライ機能
  - _Requirements: 5.1, 5.2, 6.1, 6.2_

- [ ] 8. Discord Embed表示の実装
- [ ] 8.1 天気情報の視覚的表示
  - 天気情報用のDiscord Embed作成
  - 天気アイコンと色分けの実装
  - 温度単位（摂氏）での表示
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 8.2 予報情報の表示最適化
  - 複数日予報のページネーション
  - 長いメッセージの分割表示
  - エラーメッセージの適切な表示
  - _Requirements: 7.4, 1.4, 2.3_

- [ ] 9. エラーハンドリングとロバストネスの実装
- [ ] 9.1 API障害対応
  - 気象庁APIエラー時の処理
  - Google Gemini APIエラー時の処理
  - レート制限とリトライ機能
  - _Requirements: 1.4, 6.4, 8.3_

- [ ] 9.2 データベース障害対応
  - データベース接続エラー処理
  - 一時的なメモリストレージ機能
  - データ整合性チェック
  - _Requirements: 3.5, 8.3_

- [ ] 10. テストスイートの実装
- [ ] 10.1 ユニットテストの作成
  - WeatherServiceのテスト（APIモック使用）
  - UserServiceのテスト（データベース操作）
  - AIServiceのテスト（Gemini APIモック）
  - _Requirements: 全要件のテストカバレッジ_

- [ ] 10.2 統合テストの作成
  - 実際のAPIとの統合テスト
  - データベース統合テスト
  - Discord統合テスト（テストサーバー使用）
  - _Requirements: 全要件の統合テスト_

- [ ] 11. 管理者機能とデプロイメント準備
- [ ] 11.1 管理者コマンドの実装
  - `/weather-config`コマンド（サーバー設定）
  - ボット統計情報の表示機能
  - ログ管理とモニタリング機能
  - _Requirements: 8.1, 8.2, 8.3_

- [ ] 11.2 本番環境対応
  - PostgreSQL対応の実装
  - 環境別設定の分離
  - ログ設定とエラー監視
  - _Requirements: 8.3_

- [ ] 12. ドキュメントとデプロイメント
- [ ] 12.1 ユーザードキュメントの作成
  - コマンド使用方法のドキュメント
  - セットアップガイドの作成
  - トラブルシューティングガイド
  - _Requirements: 全要件のドキュメント化_

- [ ] 12.2 デプロイメント設定
  - Docker設定の作成
  - 環境変数設定ガイド
  - 本番環境デプロイメント手順
  - _Requirements: 8.3_